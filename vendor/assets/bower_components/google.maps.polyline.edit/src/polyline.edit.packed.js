(function(a){if(google.maps.Polyline.prototype.edit===a){function b(b,c){function p(){this.setIcon(o)}function q(){this.setIcon(n)}function r(){var a=this.getPosition();a.marker=this,a.ghostMarker=g(this.editIndex).ghostMarker,b.getPath().setAt(this.editIndex,a),c.ghosts&&k(this)}function s(){google.maps.event.trigger(b,"update_at",this.editIndex,this.getPosition())}function t(){if(!c.ghosts)return;var d=g(this.editIndex),e=g(this.editIndex-1);d.ghostMarker&&d.ghostMarker.setMap(null),console.log(this.editIndex),b.getPath().removeAt(this.editIndex),e&&(this.editIndex<b.getPath().getLength()?k(e.marker):(e.ghostMarker.setMap(null),e.ghostMarker=a)),this.setMap(null),b.getPath().forEach(function(a,b){a.marker&&(a.marker.editIndex=b)}),b.getPath().getLength()===1&&b.getPath().pop().marker.setMap(null),google.maps.event.trigger(b,"remove_at",this.editIndex,d)}function u(a){var c=a.marker;return c||(c=new google.maps.Marker({position:a,map:b.getMap(),icon:n,draggable:!0,raiseOnDrag:!1}),google.maps.event.addListener(c,"mouseover",p),google.maps.event.addListener(c,"mouseout",q),google.maps.event.addListener(c,"drag",r),google.maps.event.addListener(c,"dragend",s),google.maps.event.addListener(c,"rightclick",t),a.marker=c),c.setPosition(a),c}c=c||{},c.ghosts=c.ghosts||c.ghosts===a,c.imagePath=c.imagePath||google.maps.Polyline.prototype.edit.settings.imagePath;if(c.ghosts){var d=new google.maps.MarkerImage(c.imagePath+"ghostVertex.png",new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6)),e=new google.maps.MarkerImage(c.imagePath+"ghostVertexOver.png",new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6)),f=new google.maps.Polyline({map:b.getMap(),strokeColor:b.strokeColor,strokeOpacity:.2,strokeWeight:b.strokeWeight});function g(a){return b.getPath().getAt(a)}function h(){this.setIcon(e)}function i(){this.setIcon(d)}function j(){f.getPath().getLength()===0&&f.setPath([this.marker.getPosition(),this.getPosition(),g(this.marker.editIndex+1)]),f.getPath().setAt(1,this.getPosition())}function k(a){var b=g(a.editIndex),c=g(a.editIndex-1),d=g(a.editIndex+1),e=a.getPosition();b&&b.ghostMarker&&(google.maps.geometry?b.ghostMarker.setPosition(google.maps.geometry.spherical.interpolate(b,d,.5)):b.ghostMarker.setPosition(new google.maps.LatLng(b.lat()+.5*(d.lat()-b.lat()),b.lng()+.5*(d.lng()-b.lng())))),c&&c.ghostMarker&&(google.maps.geometry?c.ghostMarker.setPosition(google.maps.geometry.spherical.interpolate(c,e,.5)):c.ghostMarker.setPosition(new google.maps.LatLng(c.lat()+.5*(e.lat()-c.lat()),c.lng()+.5*(e.lng()-c.lng()))))}function l(){var a=this.getPosition(),c=this.marker.editIndex+1,d;f.getPath().forEach(function(){f.getPath().pop()}),b.getPath().insertAt(c,a),d=u(g(c)),d.editIndex=c,k(this.marker),m(g(c)),b.getPath().forEach(function(a,b){a.marker&&(a.marker.editIndex=b)}),google.maps.event.trigger(b,"insert_at",c,a)}function m(a){if(a.marker.editIndex<b.getPath().getLength()-1){var c=g(a.marker.editIndex+1),e,f;return google.maps.geometry?e=google.maps.geometry.spherical.interpolate(a,c,.5):e=new google.maps.LatLng(a.lat()+.5*(c.lat()-a.lat()),a.lng()+.5*(c.lng()-a.lng())),f=a.ghostMarker,f||(f=new google.maps.Marker({map:b.getMap(),icon:d,draggable:!0,raiseOnDrag:!1}),google.maps.event.addListener(f,"mouseover",h),google.maps.event.addListener(f,"mouseout",i),google.maps.event.addListener(f,"drag",j),google.maps.event.addListener(f,"dragend",l),a.ghostMarker=f,f.marker=a.marker),f.setPosition(e),f}return null}}var n=new google.maps.MarkerImage(c.imagePath+"vertex.png",new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6)),o=new google.maps.MarkerImage(c.imagePath+"vertexOver.png",new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6));b.getPath().forEach(function(a,b){u(a).editIndex=b,c.ghosts&&m(a)}),google.maps.event.trigger(b,"edit_start")}function c(b){b.getPath().forEach(function(b,c){b.marker&&(b.marker.setMap(null),b.marker=a),b.ghostMarker&&(b.ghostMarker.setMap(null),b.ghostMarker=a)}),google.maps.event.trigger(b,"edit_end",b.getPath())}google.maps.Polyline.prototype.edit=function(d,e){d||d===a?(!e&&typeof d=="object"&&(e=d),b(this,e)):c(this)},google.maps.Polyline.prototype.edit.settings={imagePath:"../src/images/"}}})()